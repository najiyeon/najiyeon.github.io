---
# multilingual page pair id, this must pair with translations of this page. (This name must be unique)
lng_pair: id_SP_final3
title: "System Programming Ch15 - Ch16"

# post specific
# if not specified, .name will be used from _data/owner/[language].yml
author: Jiyeon Na
# multiple category is not supported
category: System Programming
# multiple tag entries are possible
tags: [SP, CH15, CH16, FINAL]
# thumbnail image for post
img: ":post_pic_sp_final3_1.png"
# disable comments on this page
#comments_disable: true

# publish date
date: 2022-12-09 17:00:00 +0900

# seo
# if not specified, date will be used.
#meta_modify_date: 2022-01-01 10:04:30 +0900
# check the meta_common_description in _data/owner/[language].yml
#meta_description: ""

# optional
# please use the "image_viewer_on" below to enable image viewer for individual pages or posts (_posts/ or [language]/_posts folders).
# image viewer can be enabled or disabled for all posts using the "image_viewer_posts: true" setting in _data/conf/main.yml.
#image_viewer_on: true
# please use the "image_lazy_loader_on" below to enable image lazy loader for individual pages or posts (_posts/ or [language]/_posts folders).
# image lazy loader can be enabled or disabled for all posts using the "image_lazy_loader_posts: true" setting in _data/conf/main.yml.
#image_lazy_loader_on: true
# exclude from on site search
#on_site_search_exclude: true
# exclude from search engines
#search_engine_exclude: true
# to disable this page, simply set published: false or delete this file
#published: false
---

# ğŸ’¡Â Chap_15

## Pipes

 (pipeëŠ” ê°œë…ìì²´ê°€ ê·¸ë ‡ê²Œ ì–´ë µì§€ ì•Šê¸° ë•Œë¬¸ì— ë‹¨ë‹µí˜•ìœ¼ë¡œ ë‚˜ì˜¬ í™•ë¥  í¼)

***pipe***

- ***half - duplex*** : ë³´í†µ ë°˜ì´ì¤‘ì´ë¼ê³  í•¨, ë‹¨ë°©í–¥, íŠ¹ì •ì‹œì ì—ëŠ” í•œëª…ë§Œ í†µì‹ ê°€ëŠ¥, í•œëª…ì€ senderê³  í•œëª…ì€ reciever


![pipe](:post_pic_sp_final3_1.png){:width="700px"}

 (ê·¸ë¦¼ ì™¸ìš¸ í•„ìš”ëŠ” X, ì´í•´ë§Œ í•˜ë©´ ë¨)

- pipeë¼ëŠ” í•¨ìˆ˜ ì¸ìëŠ” file descriptor ë°°ì—´ 2ê°œ
- ë°˜ì´ì¤‘ì´ê¸° ë•Œë¬¸ì— ì…ë ¥ í•˜ë‚˜, ì¶œë ¥ í•˜ë‚˜ë¡œ 2ê°œì„
- 0ì€ ì…ë ¥, 1ì€ ì¶œë ¥

<br>

![pipe2](:post_pic_sp_final3_2.png){:width="700px"}

  ìœ„ êµ¬ì¡°ëŠ”

- parentì˜ 0ì´ childì˜ 1, parentì˜ 1ì´ childì˜ 0ìœ¼ë¡œ ë“¤ì–´ê°
- parentì™€ child process ê°„ì— ì„œë¡œ ì…ë ¥ì„ ì£¼ê³ ë°›ëŠ” ê²ƒ
- ì´ëŸ´ë•ŒëŠ” ë°˜ì´ì¤‘ì´ ì•„ë‹˜
- pipelinedìœ¼ë¡œ ì£¼ê³ ë°›ëŠ” ì±„íŒ… í”„ë¡œê·¸ë¨ ë§Œë“¤ë•ŒëŠ” ì´ë ‡ê²Œ ë‘˜ ë‹¤ ì”€
- sendì™€ recieveë¥¼ ë‘˜ ë‹¤ ì—´ì–´ë‘ëŠ” ê²ƒì„

<br>


![pipe3](:post_pic_sp_final3_3.png){:width="700px"}

ì´ê±´ parent ì¶œë ¥, child recieve 
â†’ ë¶€ëª¨ëŠ” ì“°ê¸°ë§Œ í•˜ê³ , childëŠ” ë°›ê¸°ë§Œ í•¨

```c
#include "apue.h"
int main(void)
{
	Â  intÂ  n;
	Â  intÂ  fd[2];
	Â  pid_tÂ  pid;
	Â  charÂ  line[MAXLINE];
	
	Â  if (pipe(fd) < 0)
			Â  err_sys("pipe error");
	Â  if ((pid = fork()) < 0) {
			Â  err_sys("fork error");
	Â  } else if (pid > 0) {Â  /* parent */
			Â  close(fd[0]); //ì…ë ¥ ì•ˆë°›ìŒ
			Â  write(fd[1], "hello world\n", 12); //hello worldë¥¼ ì¶œë ¥í•  ê²ƒì„
	Â  } else {Â  /* child */
			Â  close(fd[1]); //ì¶œë ¥ ì•ˆí•¨
			Â  n = read(fd[0], line, MAXLINE); //ì…ë ¥ë§Œ ë°›ìŒ
			Â  write(STDOUT_FILENO, line, n);
	Â  }
	Â  exit(0);
}
```

- `if (pipe(fd) < 0)`ì—ì„œ fd ëŠ” `intÂ  fd[2];`
- pipeë¼ëŠ” í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í–ˆì„ ë•Œ ì¸ìë¡œ fdë¥¼ ë„£ì–´ì¤€ë‹¤ëŠ” ê²ƒì€,
- fd 0ì—ëŠ” ì…ë ¥, 1ì—ëŠ” ì¶œë ¥ì„ í• ë‹¹í•˜ê² ë‹¤ëŠ” ê²ƒì„

- `if ((pid = fork()) < 0)` : forkë¥¼ í–ˆëŠ”ë° 0ë³´ë‹¤ ì‘ìœ¼ë©´ child processë§Œë“œëŠ” ê²ƒì„ ì‹¤íŒ¨í–ˆìœ¼ë‹ˆ ì—ëŸ¬,
    
    ì •ìƒì ìœ¼ë¡œ ë™ì‘í–ˆë‹¤ë©´ parentëŠ” 0ë³´ë‹¤ í° ì–‘ìˆ˜ê°’(child process id)ì„ ê°€ì§ˆ ê²ƒì´ê³ , ìì‹ í”„ë¡œì„¸ìŠ¤ ê·¸ ìì‹ ì€ pidê°’ì´ 0ì¼ ê²ƒì„
    
- í•˜ë‚˜ì˜ ì½”ë“œ ì•ˆì—ì„œ ë‘ê°œì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ ì œì–´í•˜ë‹¤ ë³´ë‹ˆê¹Œ if ë¬¸ê³¼ elseë¬¸ìœ¼ë¡œ ë‚˜ë‰˜ê²Œ ë˜ëŠ” ê²ƒ

<br>

***cat file \| pager***

***pager*** : ì±…ì„ ë„˜ê¸°ëŠ” ê²ƒì²˜ëŸ¼ ëª¨ë‹ˆí„° ì•ˆì— í‘œí˜„í•  ìˆ˜ ì—†ì„ ë§Œí¼ ë§ì€ ì–‘ì´ ë“¤ì–´ì˜¤ë©´ ë‹¤ìŒì¥ìœ¼ë¡œ ë„˜ê²¨ì£¼ëŠ” ê¸°ëŠ¥

- cat fileë¡œ íŒŒì¼ì„ ì½ì—ˆëŠ”ë°, í•œ ëª¨ë‹ˆí„°ì— ì¶œë ¥í•˜ì§€ ëª»í• ë§Œí¼ ë„ˆë¬´ ê¸¸ë©´ pagerë¡œ ë‹¤ìŒì¥ìœ¼ë¡œ ë„˜ê¸°ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì£¼ë¼ëŠ” ê²ƒ
- êµ¬í˜„í•˜ë ¤ë©´ pipe fork dup exec í•¨ìˆ˜ë¥¼ ì¨ì„œ êµ¬í˜„í•´ì•¼ë¨
- ê·¸ê±¸ êµ¬í˜„í•œ ì½”ë“œê°€ ë°‘ì— ì½”ë“œ

<br>

 **ì‹œí—˜ì— ë¬´ì¡°ê±´ ë‚˜ì˜´!! ì½”ë“œ ì™¸ì›Œì•¼ë¨**

```c
#include "apue.h"
#include <sys/wait.h>
#defineÂ  DEF_PAGERÂ  "/bin/more"
int main(int argc, char *argv[])
{
	Â Â  intÂ  n;
	Â Â  intÂ  fd[2];
	Â Â  pid_tÂ  pid;
	Â Â  charÂ  *pager, *argv0;
	Â Â  charÂ  line[MAXLINE];
	Â Â  FILEÂ  *fp;
	
	Â Â  if (argc != 2)
		Â Â Â Â Â  err_quit("usage: a.out <pathname>");

		 //ì¸ìê°€ í•˜ë‚˜ì¼ ê²½ìš°ì—ë§Œ ë™ì‘
	Â Â  if ((fp = fopen(argv[1], "r")) == NULL) //ì²«ë²ˆì§¸ ì¸ìë¡œ ë“¤ì–´ì˜¨ ì• ë¥¼ ì½ê¸° ê¶Œí•œìœ¼ë¡œ ì—´ìŒ
		Â Â Â Â Â  err_sys("can't open %s", argv[1]);
	Â Â  if (pipe(fd) < 0) //pipe ë§Œë“¤ì—ˆìŒ
		Â Â Â Â Â  err_sys("pipe error");
	
	Â Â  if ((pid = fork()) < 0) { //fork 0ë³´ë‹¤ ì‘ìœ¼ë©´ ì—ëŸ¬
		Â Â Â Â Â  err_sys("fork error"); 
		 } else if (pid > 0) {Â  //0ë³´ë‹¤ í¬ë‹ˆê¹Œ parent
			Â Â  **close(fd[0]);**Â Â  //parentëŠ” ì…ë ¥ì„ ì•ˆí•¨, ì¶œë ¥ë§Œ(ì“°ê¸°ë§Œ)
	
			Â Â  /* parent copies argv[1] to pipe */
			Â Â  **while (fgets(line, MAXLINE, fp)!= NULL)** { //fpë¡œë¶€í„° ë¬¸ìì—´ì„ ì…ë ¥ë°›ê² ë‹¤ëŠ” ê²ƒ, MAXLINEë§Œí¼
			Â Â Â Â Â  n = strlen(line);
			Â Â Â Â Â  **if (write(fd[1], line, n) != n)** //fd[1]ë¡œ writeë¥¼ í•¨, line,ì¦‰ íŒŒì¼ì˜ ëê¹Œì§€
			Â Â Â Â Â Â Â Â Â  err_sys("write error to pipe");
			Â Â Â } //íŒŒì¼ì„ ë‹¤ ì½ì„ ë•Œê¹Œì§€ whileë¬¸ ëŒê³ 

	Â Â Â Â Â   if (ferror(fp))
	Â Â Â Â Â Â Â  Â Â  err_sys("fgets error");
 
 	Â Â Â Â Â   /* close write end of pipe for reader */
 	Â Â Â Â Â   **close(fd[1]);** //ì¶œë ¥í•˜ëŠ” pipe ë‹«ìŒ

	Â Â Â Â Â   **if (waitpid(pid, NULL, 0) < 0)** //ìì‹í”„ë¡œì„¸ìŠ¤ê°€ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
		Â Â Â Â Â Â Â Â  err_sys("waitpid error");
	Â Â Â Â Â  exit(0);
		} else {Â  //pidê°€ 0ì¸ ê²½ìš°, ìì‹ í”„ë¡œì„¸ìŠ¤
			Â Â  **close(fd[1]);** //ìì‹ í”„ë¡œì„¸ìŠ¤ëŠ” ì½ê¸°ë§Œ í•¨, ì¶œë ¥ x
			Â Â  **if (fd[0] != STDIN_FILENO) {** //ì…ë ¥ì´ ì•„ë‹ˆë©´
			Â Â Â Â Â  **if (dup2(fd[0], STDIN_FILENO) != STDIN_FILENO)** //dup2, íŒŒì¼ë””ìŠ¤í¬ë¦½í„°ë¥¼ ë³µì‚¬, fd[0]ë¥¼ ì…ë ¥ë°›ëŠ” íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¡œ ê°•ì œë¡œ ë³µì‚¬í•´ì¤˜ë¼
			Â Â Â Â Â Â Â Â Â  err_sys("dup2 error to stdin"); //ê·¸ë˜ë„ ì…ë ¥ë°›ëŠ”ì• ë¡œ ì„¸íŒ…ì´ ì•ˆë˜ë©´ ì—ëŸ¬
			Â Â Â Â Â Â Â Â Â  /* don't need this after dup2 */ 
			Â Â Â Â Â Â Â Â Â  close(fd[0]); Â  
			Â Â Â Â Â  }
	
			Â Â Â Â Â  /* get arguments for execl() */
			Â Â Â Â Â  if ((pager = getenv("PAGER")) == NULL)
				Â Â Â Â Â Â Â Â  pager = DEF_PAGER;
			Â Â Â Â Â  if ((argv0 = strrchr(pager, '/')) != NULL)
				Â Â Â Â Â Â Â Â  argv0++; 
			Â Â Â Â Â  else
				Â Â Â Â Â Â Â Â  argv0 = pager;
	
			Â Â Â Â Â  **if (execl(pager, argv0, (char *)0) < 0)** //execlë¡œ pager ëª…ë ¹ì–´ ìˆ˜í–‰
				Â Â Â Â Â Â Â Â  err_sys("execl error for %s", pager);
				Â Â }
	Â Â  exit(0);
}
```

<br>

# ğŸ’¡Â Chap_16

## Socket Types

 **tcpì™€ udpì˜ ì°¨ì´ê°€ ì¤‘ìš”!**

![socket type](:post_pic_sp_final3_4.png){:width="700px"}

- ***tcp*** : ***STREAM***, ì—°ê²°ì§€í–¥ì„±, ì‹ ë¢°ì„±, ì•ˆì •ì 
- ***udp*** : ***DATAGRAM***, ë¹„ì—°ê²°ì„±, ë¹„ì‹ ë¢°ì„±, ë§‰ë¬´ê°€ë‚´

<br>

## Byte Ordering

 ***ì‹œìŠ¤í…œí”„ë¡œê·¸ë˜ë°, ì‹œìŠ¤í…œí•´í‚¹ì˜ ê½ƒ***

```c
#include <arpa/inet.h>
uint32_t htonl(uint32_t hostint32);
uint16_t htons(uint16_t hostint16);
uint32_t ntohl(uint32_t netint32);
uint16_t ntohs(uint16_t netint16);
```

- ***hton*** : host to network (lì€ long, sëŠ” short)
    - ë‚´ê°€ ì§€ê¸ˆ pcì—ì„œ ì“°ê³  ìˆëŠ” little-endian ë°©ì‹ì„ networkì—ì„œ ì“°ê³  ìˆëŠ” big-endian ë°©ì‹ìœ¼ë¡œ ë°”ê¾¼ë‹¤ëŠ” ê²ƒ
- ***ntoh*** : network to host
    - networkì—ì„œ ì‚¬ìš©í•˜ê³  ìˆëŠ” big-endian ë°©ì‹ì„ hostì—ì„œ ì‚¬ìš©í•˜ëŠ” litte-endian ë°©ì‹ìœ¼ë¡œ ë°”ê¿ˆ

![endian](:post_pic_sp_final3_5.png){:width="700px"}

- ***Big-endian*** : ìˆœì„œëŒ€ë¡œ, ëŒ€ì†Œë¹„êµê°€  í¸í•´ì§, ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‚¬ìš©(ipë¡œ pcë¥¼ êµ¬ë¶„í•˜ê¸° ë•Œë¬¸ì—)
- ***Little-endian*** : ê±°ê¾¸ë¡œ ì €ì¥, í™€ì§êµ¬ë¶„ì´ í¸í•´ì§, ì»´í“¨í„°ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©

<br>

## Socket System Calls for Connection-Oriented Protocol

 ***ì—°ê²°ì§€í–¥ì„± TCP, ì‹ ë¢°ì„± ìˆìŒ***

![connection-oriented protocol](:post_pic_sp_final3_6.png){:width="700px"}

- ì™¼ìª½ì„œë²„ì—ì„œ ì†Œì¼“ í•¨ìˆ˜ë¥¼ ë¶€ë¦„ â†’ íœ´ëŒ€í° í•˜ë‚˜ ì‚¬ëŠ” ê²ƒ
- bind í•¨ìˆ˜ â†’ ìœ ì‹¬ ê½‚ê³  ì „í™”ë²ˆí˜¸ ë¶€ì—¬ ë°›ëŠ” ê²ƒ
- listen â†’ ì „í™” ì˜¬ë•Œê¹Œì§€ ëŒ€ê¸°
- accept â†’ ì „í™”ì˜¨ê±° í†µí™”ë²„íŠ¼ ìŠ¬ë¼ì´ë“œ
- client â†’ ì†Œì¼“, ì „í™”ë¥¼ í•˜ë‚˜ ì‚¼, ê·¼ë° ì „í™”ë¥¼ ë°›ì§„ ëª»í•˜ê³  í•  ìˆ˜ë§Œ ìˆëŠ”ê²ƒ, ëŒ€í¬í°
    
               â†’ bindë¥¼ í•˜ì§€ ì•ŠìŒ, ì†Œì¼“í•˜ë‚˜ë¡œ ë°”ë¡œ ì„œë²„ì— ì—°ê²°(connect)
    
<br>

## Socket System Calls for Connectionless Protocol

 ***ë¹„ì—°ê²°ì„± UDP, ì‹ ë¢°ì„± ì—†ìŒ***

![connectionless protocol](:post_pic_sp_final3_7.png){:width="700px"}

- ì„œë²„ìª½ì—ì„œ ì„œë²„ë¥¼ ë§Œë“¤ê³ (socket), ìœ ì‹¬ ê½‚ê³ (bind), ë°ì´í„° ì˜¬ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤(recvfrom)
- listenê³¼ acceptê°€ ì—†ìŒ
- clientìª½ì—ì„œëŠ” socketí•˜ê³  bind ë°›ì•„ì•¼ë¨


 TCP vs UDP

- TCPëŠ” clientì˜ idë¥¼ bindí•˜ì§€ ì•Šì•„ë„ ì„œë²„ì— ì˜í•˜ì—¬ ì‹ë³„í•  ìˆ˜ ìˆìŒ (handlerê°€ ìƒê²¨ì„œ)
- UDPëŠ” clientì—ì„œ idë¥¼ ì„œë²„ë¡œ ì•Œë ¤ì¤˜ì•¼í•¨ (ì—°ê²°ì„±ì´ ì—†ê¸° ë•Œë¬¸ì—)


<br>

## Date Transfer

```c
#include <sys/socket.h>
ssize_t send(int sockfd, const void *buf, size_t nbytes, int flags);

#include <sys/socket.h>
ssize_t sendto(int sockfd, const void *buf, size_t nbytes, int flags, const struct sockaddr *destaddr, socklen_t destlen);

#include <sys/socket.h>
ssize_t recv(int sockfd, void *buf, size_t nbytes, int flags);

#include <sys/socket.h>
ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *addr, socklen_t *addrlen);
```

- TCPì—ì„œ ì“°ëŠ” í•¨ìˆ˜ : send, recv
- UDPì—ì„œ ì“°ëŠ” í•¨ìˆ˜ : sendto, recvfrom

